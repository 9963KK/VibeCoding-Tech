# Vibe 开发流程技术规范

> 基于SOLID、DRY、KISS、YAGNI原则构建的完整开发流程体系

## 📚 文档导航

本规范由以下核心文档组成：

### 1️⃣ [需求评审决策树](./01-需求评审决策树.md)
**核心内容**:
- 需求描述模板
- 需求评审决策流程
- 技术可行性评估标准
- 架构影响判断标准
- 优先级评分矩阵

**适用场景**:
- 新需求接入时
- 需要判断是否接受某个需求
- 评估需求的优先级

**关键价值**:
- ✅ 确保需求符合产品愿景
- ✅ 评估技术可行性
- ✅ 科学划分优先级
- ✅ 自动生成功能清单

---

### 2️⃣ [开发生命周期](./02-开发生命周期.md)
**核心内容**:
- 7个开发阶段详解：规划设计 → 功能开发 → 代码审查 → 集成测试 → 文档同步 → 部署上线 → 监控反馈
- 每个阶段的输入输出
- 每个阶段的Definition of Done
- 完整的检查清单

**适用场景**:
- 开始一个新功能开发时
- 不确定当前阶段应该做什么
- 检查是否满足进入下一阶段的条件

**关键价值**:
- ✅ 明确每个阶段的职责
- ✅ 清晰的质量标准
- ✅ 可操作的检查清单
- ✅ 异常处理流程

---

### 3️⃣ [文档自动同步机制](./03-文档自动同步机制.md)
**核心内容**:
- 变更检测与分析规则
- 自动生成文档更新任务
- CI自动检查配置
- 文档新鲜度追踪
- 文档覆盖率统计

**适用场景**:
- 代码变更后需要更新文档
- 不确定哪些文档需要更新
- 检查文档是否与代码一致

**关键价值**:
- ✅ 自动检测需要更新的文档
- ✅ 防止文档滞后
- ✅ CI自动验证文档一致性
- ✅ 文档健康度监控

---

### 4️⃣ [质量门禁标准](./04-质量门禁标准.md)
**核心内容**:
- 代码质量指标体系
- 6个质量门禁详解：本地开发 → PR创建 → 代码审查 → 合并前 → 部署前 → 发布后
- 自动化工具配置
- 质量监控仪表板

**适用场景**:
- 提交代码前自我检查
- 配置CI/CD流水线
- 进行代码审查时
- 发布前最终检查

**关键价值**:
- ✅ 明确的质量标准
- ✅ 自动化质量检查
- ✅ 多层次质量防护
- ✅ 可量化的质量指标

---

## 🔄 完整流程示意图

```
需求提出
   ↓
需求评审 (01-需求评审决策树.md)
   ├─ 拒绝 → 记录到rejected-requirements.md
   └─ 通过 → 创建功能清单
              ↓
       规划设计 (02-开发生命周期.md - 阶段一)
              ├─ 技术方案设计
              ├─ 更新规划文档
              └─ 任务拆解
              ↓
       功能开发 (02-开发生命周期.md - 阶段二)
              ├─ 本地开发
              ├─ 编写测试
              └─ 通过本地质量门禁 (04-质量门禁标准.md - 门禁1)
              ↓
       代码审查 (02-开发生命周期.md - 阶段三)
              ├─ 创建PR
              ├─ 通过CI质量门禁 (04-质量门禁标准.md - 门禁2)
              └─ 人工Review通过 (04-质量门禁标准.md - 门禁3)
              ↓
       集成测试 (02-开发生命周期.md - 阶段四)
              ├─ 功能验证
              ├─ 集成场景测试
              └─ 性能测试
              ↓
       文档同步 (02-开发生命周期.md - 阶段五)
              ├─ 自动检测需更新文档 (03-文档自动同步机制.md)
              ├─ 更新相关文档
              └─ 通过合并前门禁 (04-质量门禁标准.md - 门禁4)
              ↓
       部署上线 (02-开发生命周期.md - 阶段六)
              ├─ 通过部署前门禁 (04-质量门禁标准.md - 门禁5)
              ├─ 灰度发布
              └─ 冒烟测试
              ↓
       监控反馈 (02-开发生命周期.md - 阶段七)
              ├─ 通过发布后门禁 (04-质量门禁标准.md - 门禁6)
              ├─ 持续监控
              └─ 收集反馈
              ↓
       功能完成 ✅
```

---

## 🎯 核心设计原则

### SOLID 原则
- **S - 单一职责**: 每个模块/类/函数只做一件事
- **O - 开闭原则**: 对扩展开放，对修改封闭
- **L - 里氏替换**: 子类可以替换父类
- **I - 接口隔离**: 接口应该小而专一
- **D - 依赖倒置**: 依赖抽象而非具体实现

### DRY 原则 (Don't Repeat Yourself)
- 避免代码重复
- 提取公共逻辑
- 建立可复用的组件

### KISS 原则 (Keep It Simple, Stupid)
- 追求简洁
- 避免过度设计
- 优先选择简单方案

### YAGNI 原则 (You Aren't Gonna Need It)
- 只实现当前需要的功能
- 不预留"未来可能"的扩展
- 避免过度工程

---

## 📊 质量指标目标

| 指标类别 | 指标名称 | 目标值 |
|---------|---------|--------|
| **代码质量** | 单元测试覆盖率 | ≥80% |
| | 代码重复率 | ≤5% |
| | 平均圈复杂度 | ≤10 |
| | 函数最大行数 | ≤50行 |
| **性能指标** | API平均响应时间 | <200ms |
| | API P95响应时间 | <500ms |
| | 首屏加载时间 | <2s |
| **安全指标** | 高危漏洞 | 0 |
| | 中危漏洞 | ≤5 |
| **流程指标** | CI通过率 | ≥90% |
| | 发布失败率 | <5% |

---

## 🚀 快速开始

### 新需求接入流程
1. 填写需求卡片（参考 [01-需求评审决策树.md](./01-需求评审决策树.md)）
2. 进行需求评审
3. 通过后自动创建功能清单
4. 按照 [02-开发生命周期.md](./02-开发生命周期.md) 开始开发

### 开发前准备
1. 配置Git Hooks（参考 [04-质量门禁标准.md](./04-质量门禁标准.md#husky配置)）
2. 安装代码质量工具（ESLint、Prettier、Jest）
3. 配置IDE代码风格

### 开发中检查
1. 遵循编码规范
2. 编写单元测试（覆盖率≥80%）
3. 提交前通过本地质量门禁
4. 创建PR并等待CI检查

### 文档更新
1. 代码变更时自动检测需更新文档（参考 [03-文档自动同步机制.md](./03-文档自动同步机制.md)）
2. 按照提示更新相关文档
3. 确保文档与代码一致

---

## 🛠️ 工具链推荐

### 代码质量工具
- **ESLint**: JavaScript/TypeScript代码检查
- **Prettier**: 代码格式化
- **SonarQube**: 代码质量分析平台
- **Jest**: JavaScript测试框架
- **Pytest**: Python测试框架

### 安全扫描工具
- **npm audit**: Node.js依赖安全扫描
- **Snyk**: 漏洞扫描与修复
- **git-secrets**: 防止敏感信息泄露
- **TruffleHog**: 扫描Git历史中的密钥

### 文档工具
- **Swagger/OpenAPI**: API文档生成
- **TypeDoc/JSDoc**: 代码文档生成
- **Mermaid**: 流程图/架构图
- **markdown-link-check**: 文档链接检查

### CI/CD工具
- **GitHub Actions**: 自动化流水线
- **Docker**: 容器化
- **Kubernetes**: 容器编排

---

## 📋 常用检查清单

### 提交代码前
- [ ] 代码格式检查通过 (`npm run lint`)
- [ ] 类型检查通过 (`npm run type-check`)
- [ ] 单元测试通过 (`npm run test`)
- [ ] 测试覆盖率≥80%
- [ ] 无调试代码残留

### 创建PR前
- [ ] PR标题清晰
- [ ] PR描述完整
- [ ] 关联功能清单
- [ ] 自测通过

### 合并PR前
- [ ] 所有CI检查通过
- [ ] 至少1位Reviewer批准
- [ ] 所有审查意见已解决
- [ ] 文档已更新
- [ ] 无合并冲突

### 部署前
- [ ] 版本号已更新
- [ ] CHANGELOG已更新
- [ ] 环境配置正确
- [ ] 数据库备份完成
- [ ] 回滚方案已准备

---

## 🎓 最佳实践

### 1. 小步快跑
- PR大小控制在500行以内
- 功能拆分为可独立交付的小块
- 频繁集成，避免大规模合并

### 2. 测试先行
- 编写代码前先写测试（TDD）
- 关键逻辑必须有单元测试
- 重要流程必须有集成测试

### 3. 持续重构
- 遵循"童子军规则"：让代码比你接手时更好
- 发现技术债及时偿还
- 定期进行代码审查

### 4. 文档同步
- 代码和文档在同一个PR中更新
- 文档使用Git进行版本控制
- 通过CI自动检查文档一致性

### 5. 自动化优先
- 能自动化的绝不手工
- 持续优化工具链
- 减少重复劳动

---

## 🚫 常见反模式

### ❌ 反模式1: "等有空再写测试"
**问题**: 永远不会有"有空的时候"
**解决**: 测试和代码同步完成，作为DoD的一部分

### ❌ 反模式2: "先实现功能，文档之后再说"
**问题**: 文档永远滞后，最后失去参考价值
**解决**: 文档更新和代码变更在同一个PR中完成

### ❌ 反模式3: "这个功能简单，不需要Review"
**问题**: 小问题累积成大问题
**解决**: 所有代码变更都必须经过Review

### ❌ 反模式4: "CI失败了，应该是环境问题"
**问题**: 忽视警告信号，最终导致更大问题
**解决**: CI失败必须立即修复，不允许带病上线

### ❌ 反模式5: "这个接口只有内部用，安全性不重要"
**问题**: 内部接口也可能被攻击
**解决**: 所有接口都必须进行安全检查

---

## 📚 扩展阅读

### 编码原则
- [Clean Code - Robert C. Martin](https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882)
- [重构：改善既有代码的设计 - Martin Fowler](https://refactoring.com/)
- [代码大全 - Steve McConnell](https://www.amazon.com/Code-Complete-Practical-Handbook-Construction/dp/0735619670)

### 软件工程实践
- [Google工程实践文档](https://google.github.io/eng-practices/)
- [The Twelve-Factor App](https://12factor.net/)
- [Effective DevOps](https://www.oreilly.com/library/view/effective-devops/9781491926291/)

### 测试
- [测试金字塔 - Martin Fowler](https://martinfowler.com/articles/practical-test-pyramid.html)
- [Test Driven Development - Kent Beck](https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530)

---

## 🤝 贡献指南

本规范是动态演进的，欢迎提出改进建议！

### 如何贡献
1. Fork本仓库
2. 创建分支 `git checkout -b feature/improvement`
3. 提交变更 `git commit -m 'docs: 改进XXX文档'`
4. 推送分支 `git push origin feature/improvement`
5. 创建Pull Request

### 文档规范
- 使用Markdown格式
- 遵循现有文档结构
- 提供具体可操作的指导
- 包含示例代码或配置

---

## 📞 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue
- 发起Discussion
- 联系技术负责人

---

## 📄 许可证

本文档采用 [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/) 许可证。

---

**最后更新**: 2026-01-09
**版本**: v1.0.0
