# 附加材料（Additional Materials）

> **目的**：提供开发过程中需要的规范、技术标准和特殊注意事项的**快速索引入口**
> **原则**：本文件只提供入口与最小必要上下文，内容以链接为主；需要时再补充条目，不做过度预设

---

## 0. 使用方式与约定

### 0.1 什么时候查阅本文档

**MUST场景**（必须查阅）：
- 创建PR前：检查是否命中任何条目的"触发条件"，如命中需在PR描述中引用该条目ID
- 代码审查时：Reviewer发现问题时引用对应条目ID
- 技术方案设计时：查阅相关技术细节和规范

**SHOULD场景**（应该查阅）：
- 开发新功能前：查看是否有相关技术约束
- 遇到特殊平台规范、实现约束时
- UI/UX实现不确定时：查阅设计风格参考

### 0.2 写法约束（保持可维护）

**每条记录MUST满足**：
- 控制在**10行以内**（长内容只给链接）
- 包含：**ID / 一句话结论 / 触发条件 / 关联文件 / 链接**
- 外链不在正文散落：统一登记到【Links字典】，正文只写`L-xxx`

**分类ID命名规则**：
- 编码规范：`CS-XXX` (Coding Standards)
- API设计规范：`API-XXX`
- 数据库设计规范：`DB-XXX`
- 安全检查清单：`SEC-XXX`
- 测试策略：`TEST-XXX`
- 技术细节：`TD-XXX`
- 设计风格：`DS-XXX`
- 用户记忆：`UM-YYYYMMDD-XXX`

### 0.3 如何扩展新分类

当需要添加新分类时（如"性能优化规范"）：
1. 在本文档添加新章节，遵循"索引表 + 条目模板"结构
2. 定义新的ID前缀（如`PERF-XXX`）
3. 在0.2写法约束中添加ID命名规则
4. 更新Vibe技术规范.md中的附加材料说明

---

## 1. 编码规范（Coding Standards）

> 记录项目代码风格、设计原则、命名规范等

### 1.1 索引表

| ID | 主题 | 一句话结论 | 触发条件 | 关联文件 | 规范链接 | 状态 |
|---|---|---|---|---|---|---|
| CS-001 | SOLID原则检查 | 每个模块/类/函数必须遵循单一职责原则 | 新增模块、类、函数 | `src/**/*.ts` | L-101 | active |
| CS-002 | 命名规范 | 使用语义化命名，避免缩写和拼音 | 所有代码文件 | `src/**/*` | L-102 | active |
| CS-003 | 函数复杂度限制 | 单个函数不超过50行，圈复杂度≤10 | 新增/修改函数 | `src/**/*.ts` | L-103 | active |

### 1.2 条目模板

#### CS-XXX：<主题名>
- **一句话结论**：
- **触发条件**（命中任一即可）：
  - 路径：`...`
  - 变更类型：新增/修改/删除
  - 关键字：`...`
- **关联文件**（项目内）：
  - `...`
- **必须注意点**（最多3-5条）：
  1. ...
  2. ...
- **规范链接**：L-xxx
- **验收标准**（可选）：
  - ...

---

## 2. API设计规范（API Design Standards）

> 记录RESTful API设计原则、响应格式、错误码规范等

### 2.1 索引表

| ID | 主题 | 一句话结论 | 触发条件 | 关联文件 | 规范链接 | 状态 |
|---|---|---|---|---|---|---|
| API-001 | RESTful规范 | 使用标准HTTP方法，资源命名使用复数名词 | 新增/修改API端点 | `src/routes/**/*.ts` | L-201 | active |
| API-002 | 统一响应格式 | 所有API响应必须包含code、message、data字段 | 新增/修改API端点 | `src/controllers/**/*.ts` | L-202 | active |
| API-003 | 错误码规范 | 使用标准HTTP状态码 + 业务错误码 | 新增错误处理 | `src/errors/**/*.ts` | L-203 | active |

### 2.2 条目模板

#### API-XXX：<主题名>
- **一句话结论**：
- **触发条件**：
  - 路径：`...`
  - 变更类型：...
- **关联文件**：
  - `...`
- **必须注意点**：
  1. ...
- **规范链接**：L-xxx
- **示例**（可选）：
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {}
  }
  ```

---

## 3. 数据库设计规范（Database Design Standards）

> 记录数据库表设计、索引策略、迁移规范等

### 3.1 索引表

| ID | 主题 | 一句话结论 | 触发条件 | 关联文件 | 规范链接 | 状态 |
|---|---|---|---|---|---|---|
| DB-001 | 表命名规范 | 使用snake_case，表名使用复数 | 新增/修改数据表 | `prisma/schema.prisma` | L-301 | active |
| DB-002 | 索引设计原则 | 外键、查询条件字段必须建索引 | 新增/修改表结构 | `prisma/migrations/**/*.sql` | L-302 | active |
| DB-003 | 迁移脚本规范 | 不可直接修改Schema，必须通过migration | 数据库变更 | `prisma/` | L-303 | active |

### 3.2 条目模板

#### DB-XXX：<主题名>
- **一句话结论**：
- **触发条件**：
  - 路径：`...`
  - 变更类型：...
- **关联文件**：
  - `...`
- **必须注意点**：
  1. ...
- **规范链接**：L-xxx
- **示例**（可选）：
  ```sql
  CREATE TABLE users (
    id UUID PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL
  );
  ```

---

## 4. 安全检查清单（Security Checklist）

> 记录安全审查要点、常见漏洞防范措施

### 4.1 索引表

| ID | 主题 | 一句话结论 | 触发条件 | 关联文件 | 规范链接 | 状态 |
|---|---|---|---|---|---|---|
| SEC-001 | SQL注入防范 | 使用参数化查询，禁止字符串拼接SQL | 数据库查询相关代码 | `src/**/*.ts` | L-401 | active |
| SEC-002 | XSS防范 | 用户输入必须转义，使用Content Security Policy | 前端渲染用户输入 | `src/frontend/**/*.tsx` | L-402 | active |
| SEC-003 | 敏感信息保护 | 密码、密钥不得硬编码，必须使用环境变量 | 所有代码文件 | `src/**/*` `.env` | L-403 | active |

### 4.2 条目模板

#### SEC-XXX：<主题名>
- **一句话结论**：
- **触发条件**：
  - 路径：`...`
  - 关键字：`password` `token` `secret`
- **关联文件**：
  - `...`
- **检查方法**：
  1. ...
- **规范链接**：L-xxx
- **反例/正例**（可选）：
  ```typescript
  // ❌ 反例
  const query = `SELECT * FROM users WHERE id = ${userId}`;

  // ✅ 正例
  const query = db.query('SELECT * FROM users WHERE id = ?', [userId]);
  ```

---

## 5. 测试策略（Testing Strategy）

> 记录测试覆盖要求、测试用例编写规范

### 5.1 索引表

| ID | 主题 | 一句话结论 | 触发条件 | 关联文件 | 规范链接 | 状态 |
|---|---|---|---|---|---|---|
| TEST-001 | 测试覆盖率要求 | 单元测试覆盖率≥80%，核心模块≥90% | 所有功能代码 | `src/**/*.test.ts` | L-501 | active |
| TEST-002 | 测试用例命名 | 使用"should + 预期行为"格式 | 所有测试文件 | `**/*.test.ts` `**/*.spec.ts` | L-502 | active |
| TEST-003 | Mock策略 | 外部依赖必须Mock，避免真实网络/DB调用 | 单元测试 | `src/**/*.test.ts` | L-503 | active |

### 5.2 条目模板

#### TEST-XXX：<主题名>
- **一句话结论**：
- **触发条件**：
  - 路径：`...`
  - 变更类型：...
- **关联文件**：
  - `...`
- **必须注意点**：
  1. ...
- **规范链接**：L-xxx
- **示例**（可选）：
  ```typescript
  describe('UserAuthService', () => {
    it('should successfully register a new user', async () => {
      // Arrange
      const userData = { email: 'test@example.com', password: 'Test123!' };

      // Act
      const result = await authService.register(userData);

      // Assert
      expect(result.id).toBeDefined();
    });
  });
  ```

---

## 6. 技术细节（Technical Details）

> 记录项目特殊的技术约束/接入规范/实现注意点

### 6.1 索引表

| ID | 主题 | 一句话结论 | 触发条件 | 关联文件 | 规范链接 | 状态 |
|---|---|---|---|---|---|---|
| TD-001 | JWT Token配置 | accessToken过期时间15分钟，refreshToken 7天 | 认证相关代码 | `src/modules/auth/jwt.util.ts` | L-601 | active |
| TD-002 | WebSocket连接管理 | 使用Socket.io，支持断线重连和消息补发 | 实时通信代码 | `src/modules/chat/websocket.gateway.ts` | L-602 | active |

### 6.2 条目模板

#### TD-XXX：<主题名>
- **一句话结论**：
- **触发条件**（命中任一即可）：
  - 路径：`...`
  - 变更类型：新增/修改/删除
  - 关键字：`...`
- **关联文件**（项目内）：
  - `...`
- **必须注意点**（最多3-5条）：
  1. ...
  2. ...
- **规范链接**：L-xxx
- **验收提示**（可选）：
  - 用例标题/检查点：...

---

## 7. 设计风格参考（Design Style Reference）

> 记录前端风格基线与设计资产入口，包括配色、字体、组件风格等

### 7.1 索引表

| ID | 范围 | 风格基线描述 | 资产入口 | 落地位置 | 状态 |
|---|---|---|---|---|---|
| DS-001 | Web前端 | 采用Material Design 3风格 | L-701 | `src/frontend/styles/theme.ts` | active |
| DS-002 | 移动端 | 遵循iOS HIG和Material Design Mobile | L-702 | `src/mobile/theme/` | active |

### 7.2 条目模板

#### DS-XXX：<风格主题名>
- **风格基线一句话**：
- **权威资产入口**：L-xxx
- **配色/Token**（可选，只写关键token）：
  - Primary：`#1976D2`
  - Neutral：`#F5F5F5`
  - Danger：`#D32F2F`
- **字体与排版**（可选）：
  - 字体：Roboto / PingFang SC
  - 字号梯度：12/14/16/18/20/24
- **组件风格要点**（最多3-5条）：
  1. ...
  2. ...
- **工程落地位置**：
  - `...`

---

## 8. 用户记忆（User Memory）

> 记录用户在交互中明确强调的修改点/偏好/禁止项，避免迭代中丢失

### 8.1 索引表

| ID | 用户强调点摘要 | 影响范围 | 关联需求 | 关联文件 | 验收口径 | 状态 |
|---|---|---|---|---|---|---|
| UM-20260109-001 | 核心流程只专注开发，不包含监控和验证 | 开发流程文档 | - | `02-开发生命周期.md` | 流程终点为代码合并，不包含DevOps | done |
| UM-20260109-002 | 功能清单保持整洁，只有3要素 | 功能清单文档 | - | `模板-功能清单.md` | 每条功能只包含：名称+描述+TODO | done |

### 8.2 条目模板

#### UM-YYYYMMDD-XXX：<用户强调点标题>
- **用户强调点摘要**：
- **背景/原因**（可选，1-2句）：
- **影响范围**：
  - 功能/页面：...
- **关联需求/任务**：REQ-xxx / ISSUE-xxx
- **关联文件/页面**：
  - `...`
- **验收口径**（必须写，尽量可测试）：
  1. ...
  2. ...
- **状态**：open / doing / done / dropped（说明原因）

---

## 9. Links字典（统一管理外链/资产链接）

> **目的**：避免正文出现大量URL；正文只引用`L-xxx`

### 9.1 编码规范相关

| Link ID | 名称 | 链接 |
|---|---|---|
| L-101 | SOLID原则详解 | https://en.wikipedia.org/wiki/SOLID |
| L-102 | 命名规范参考 | https://google.github.io/styleguide/ |
| L-103 | 代码复杂度工具 | https://eslint.org/docs/rules/complexity |

### 9.2 API设计规范相关

| Link ID | 名称 | 链接 |
|---|---|---|
| L-201 | RESTful API设计指南 | https://restfulapi.net/ |
| L-202 | HTTP状态码参考 | https://httpstatuses.com/ |
| L-203 | API错误处理最佳实践 | https://www.rfc-editor.org/rfc/rfc7807 |

### 9.3 数据库设计规范相关

| Link ID | 名称 | 链接 |
|---|---|---|
| L-301 | PostgreSQL命名规范 | https://www.postgresql.org/docs/current/sql-syntax.html |
| L-302 | 索引设计最佳实践 | https://use-the-index-luke.com/ |
| L-303 | Prisma迁移文档 | https://www.prisma.io/docs/concepts/components/prisma-migrate |

### 9.4 安全检查清单相关

| Link ID | 名称 | 链接 |
|---|---|---|
| L-401 | OWASP Top 10 | https://owasp.org/www-project-top-ten/ |
| L-402 | XSS防范指南 | https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html |
| L-403 | 密钥管理最佳实践 | https://cheatsheetseries.owasp.org/cheatsheets/Key_Management_Cheat_Sheet.html |

### 9.5 测试策略相关

| Link ID | 名称 | 链接 |
|---|---|---|
| L-501 | Jest测试框架 | https://jestjs.io/ |
| L-502 | 测试金字塔 | https://martinfowler.com/articles/practical-test-pyramid.html |
| L-503 | Mock最佳实践 | https://jestjs.io/docs/mock-functions |

### 9.6 技术细节相关

| Link ID | 名称 | 链接 |
|---|---|---|
| L-601 | JWT最佳实践 | https://jwt.io/introduction |
| L-602 | Socket.io文档 | https://socket.io/docs/v4/ |

### 9.7 设计风格相关

| Link ID | 名称 | 链接 |
|---|---|---|
| L-701 | Material Design 3 | https://m3.material.io/ |
| L-702 | iOS Human Interface Guidelines | https://developer.apple.com/design/human-interface-guidelines/ |

### 9.8 内部文档（模板）

| Link ID | 名称 | 链接 |
|---|---|---|
| L-900 | Vibe技术规范 | `./Vibe技术规范.md` |
| L-901 | 项目文档模板 | `./模板-项目文档.md` |
| L-902 | 功能清单模板 | `./模板-功能清单.md` |
| L-903 | 附加材料模板 | `./模板-附加材料.md` |
| L-904 | 规范文档模板 | `./模版-规范文档.md` |

### 9.9 内部文档（Core文档）

> Core 文档在实际项目中的位置，供文档间交叉引用

| Link ID | 名称 | 链接 |
|---|---|---|
| L-910 | 规范文档 | `./规范文档.md` |
| L-911 | 项目文档 | `./项目文档.md` |
| L-912 | 功能清单 | `./功能清单.md` |
| L-913 | 附加材料 | `./附加材料.md` |

---

## 10. 使用指南

### 如何添加新条目

1. 确定条目所属分类（CS/API/DB/SEC/TEST/TD/DS/UM）
2. 分配唯一ID（如CS-004）
3. 在对应分类的索引表中添加一行
4. 在索引表下方添加详细条目（使用条目模板）
5. 如有外部链接，添加到Links字典
6. 在变更记录中记录新增

### 如何引用条目

在PR描述、代码审查、技术方案中使用：
- 引用条目：`参考 CS-001（SOLID原则检查）`
- 引用链接：`详见 L-101（SOLID原则详解）`

### 如何维护

**月度检查**（SHOULD）：
- [ ] 检查链接有效性（使用markdown-link-check）
- [ ] 清理已完成/已失效的用户记忆条目
- [ ] 更新状态字段

**季度审查**（MUST）：
- [ ] 评估条目使用频率，归档低频条目
- [ ] 收集团队反馈，补充高频问题的条目
- [ ] 同步更新Vibe技术规范.md中的附加材料说明
