# [é¡¹ç›®åç§°] é¡¹ç›®æ–‡æ¡£

> æœ€åæ›´æ–°: YYYY-MM-DD

## ğŸ“Œ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£å¸®åŠ©AI Agentå¿«é€Ÿç†è§£ï¼š
1. é¡¹ç›®æ•´ä½“æ¶æ„
2. æœ‰å“ªäº›æ¨¡å—
3. æ¯ä¸ªæ¨¡å—æœ‰å“ªäº›åŠŸèƒ½åŠå…¶å®ŒæˆçŠ¶æ€

**åŠŸèƒ½è¯¦ç»†ä¿¡æ¯**: æŸ¥çœ‹ [åŠŸèƒ½æ¸…å•æ–‡æ¡£](./åŠŸèƒ½æ¸…å•.md)

---

## 1. é¡¹ç›®æ¶æ„å›¾

```mermaid
graph TD
    A[å‰ç«¯ Frontend] --> B[APIç½‘å…³]
    B --> C[è®¤è¯æ¨¡å— Auth]
    B --> D[ç”¨æˆ·æ¨¡å— User]
    B --> E[èŠå¤©æ¨¡å— Chat]

    C --> F[æ•°æ®åº“ PostgreSQL]
    D --> F
    E --> F

    E --> G[Redis ç¼“å­˜]
    E --> H[WebSocket æœåŠ¡]
```

---

## 2. æŠ€æœ¯æ ˆç‰ˆæœ¬

| åˆ†ç±» | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| **å‰ç«¯** | React | 18.2.0 |
| | TypeScript | 5.3.0 |
| | Vite | 5.0.0 |
| **åç«¯** | Node.js | 20.10.0 |
| | Express | 4.18.2 |
| | Prisma | 5.8.0 |
| **æ•°æ®åº“** | PostgreSQL | 15.5 |
| | Redis | 7.2.0 |
| **å…¶ä»–** | JWT | - |
| | Socket.io | 4.6.0 |

---

## 3. æ¨¡å—äº¤äº’å›¾

### 3.1 ä¾èµ–å…³ç³»

```mermaid
graph LR
    A[ChatModule] -->|ä¾èµ–| B[UserModule]
    A -->|ä¾èµ–| C[AuthModule]
    B -->|ä¾èµ–| C
```

### 3.2 æ•°æ®æµ

```mermaid
sequenceDiagram
    participant Frontend
    participant AuthModule
    participant ChatModule
    participant Database

    Frontend->>AuthModule: éªŒè¯Token
    AuthModule-->>Frontend: Tokenæœ‰æ•ˆ
    Frontend->>ChatModule: å‘é€æ¶ˆæ¯
    ChatModule->>Database: ä¿å­˜æ¶ˆæ¯
    ChatModule-->>Frontend: å¹¿æ’­æ¶ˆæ¯
```

---

## 4. æ¨¡å—æ¸…å•

### 4.1 AuthModule (è®¤è¯æ¨¡å—)

**ä½ç½®**: `src/modules/auth/`

**æ ¸å¿ƒæ–‡ä»¶**:
- `auth.controller.ts` - è·¯ç”±æ§åˆ¶å™¨
- `auth.service.ts` - ä¸šåŠ¡é€»è¾‘
- `auth.middleware.ts` - è®¤è¯ä¸­é—´ä»¶
- `jwt.util.ts` - JWTå·¥å…·å‡½æ•°

**æ ¸å¿ƒå‡½æ•°**:
- `register(email, password)` - ç”¨æˆ·æ³¨å†Œ
- `login(email, password)` - ç”¨æˆ·ç™»å½•
- `refreshToken(refreshToken)` - åˆ·æ–°Token
- `verifyToken(token)` - éªŒè¯Token
- `resetPassword(email)` - å¯†ç é‡ç½®

**APIç«¯ç‚¹**:
- `POST /api/auth/register`
- `POST /api/auth/login`
- `POST /api/auth/refresh`
- `POST /api/auth/logout`

**æ•°æ®åº“è¡¨**: `users`, `auth_tokens`

**ä¾èµ–**: æ— 
**è¢«ä¾èµ–**: UserModule, ChatModule

**åŠŸèƒ½åˆ—è¡¨**:
| åŠŸèƒ½ç¼–å· | åŠŸèƒ½åç§° | çŠ¶æ€ |
|---------|---------|------|
| F-001 | ç”¨æˆ·æ³¨å†Œ | âœ… å·²å®Œæˆ |
| F-002 | ç”¨æˆ·ç™»å½• | âœ… å·²å®Œæˆ |
| F-003 | Tokenåˆ·æ–° | âœ… å·²å®Œæˆ |
| F-004 | å¯†ç é‡ç½® | âœ… å·²å®Œæˆ |
| F-005 | é‚®ç®±éªŒè¯ | âœ… å·²å®Œæˆ |

> è¯¦ç»†ä¿¡æ¯è§ [åŠŸèƒ½æ¸…å•](./åŠŸèƒ½æ¸…å•.md) å¯¹åº”æ¡ç›®

---

### 4.2 UserModule (ç”¨æˆ·ç®¡ç†æ¨¡å—)

**ä½ç½®**: `src/modules/user/`

**æ ¸å¿ƒæ–‡ä»¶**:
- `user.controller.ts` - è·¯ç”±æ§åˆ¶å™¨
- `user.service.ts` - ä¸šåŠ¡é€»è¾‘
- `user.repository.ts` - æ•°æ®è®¿é—®å±‚

**æ ¸å¿ƒå‡½æ•°**:
- `getUserById(userId)` - è·å–ç”¨æˆ·ä¿¡æ¯
- `updateProfile(userId, data)` - æ›´æ–°èµ„æ–™
- `uploadAvatar(userId, file)` - ä¸Šä¼ å¤´åƒ
- `searchUsers(query)` - æœç´¢ç”¨æˆ·
- `deleteUser(userId)` - åˆ é™¤ç”¨æˆ·

**APIç«¯ç‚¹**:
- `GET /api/users/:id`
- `PUT /api/users/:id`
- `POST /api/users/:id/avatar`
- `GET /api/users/search`
- `DELETE /api/users/:id`

**æ•°æ®åº“è¡¨**: `user_profiles`

**ä¾èµ–**: AuthModule
**è¢«ä¾èµ–**: ChatModule

**åŠŸèƒ½åˆ—è¡¨**:
| åŠŸèƒ½ç¼–å· | åŠŸèƒ½åç§° | çŠ¶æ€ |
|---------|---------|------|
| F-006 | ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ | âœ… å·²å®Œæˆ |
| F-007 | ç”¨æˆ·èµ„æ–™ç¼–è¾‘ | âœ… å·²å®Œæˆ |
| F-008 | å¤´åƒä¸Šä¼  | âœ… å·²å®Œæˆ |
| F-009 | ç”¨æˆ·æœç´¢ | âœ… å·²å®Œæˆ |
| F-010 | ç”¨æˆ·æƒé™ç®¡ç† | âœ… å·²å®Œæˆ |

> è¯¦ç»†ä¿¡æ¯è§ [åŠŸèƒ½æ¸…å•](./åŠŸèƒ½æ¸…å•.md) å¯¹åº”æ¡ç›®

---

### 4.3 ChatModule (å®æ—¶èŠå¤©æ¨¡å—)

**ä½ç½®**: `src/modules/chat/`

**æ ¸å¿ƒæ–‡ä»¶**:
- `chat.controller.ts` - è·¯ç”±æ§åˆ¶å™¨
- `chat.service.ts` - ä¸šåŠ¡é€»è¾‘
- `websocket.gateway.ts` - WebSocketå¤„ç†
- `message.repository.ts` - æ¶ˆæ¯æ•°æ®è®¿é—®

**æ ¸å¿ƒå‡½æ•°**:
- `createRoom(name, members)` - åˆ›å»ºèŠå¤©å®¤
- `sendMessage(roomId, content)` - å‘é€æ¶ˆæ¯
- `getMessages(roomId, pagination)` - è·å–å†å²æ¶ˆæ¯
- `joinRoom(userId, roomId)` - åŠ å…¥èŠå¤©å®¤
- `leaveRoom(userId, roomId)` - ç¦»å¼€èŠå¤©å®¤
- `updateOnlineStatus(userId, status)` - æ›´æ–°åœ¨çº¿çŠ¶æ€

**APIç«¯ç‚¹**:
- `POST /api/chat/rooms`
- `GET /api/chat/rooms`
- `GET /api/chat/messages/:roomId`
- `POST /api/chat/rooms/:id/join`
- `WebSocket /ws/chat`

**æ•°æ®åº“è¡¨**: `chat_rooms`, `messages`, `room_members`

**ä¾èµ–**: UserModule, AuthModule
**è¢«ä¾èµ–**: æ— 

**åŠŸèƒ½åˆ—è¡¨**:
| åŠŸèƒ½ç¼–å· | åŠŸèƒ½åç§° | çŠ¶æ€ |
|---------|---------|------|
| F-011 | åˆ›å»ºèŠå¤©å®¤ | âœ… å·²å®Œæˆ |
| F-012 | å‘é€æ–‡æœ¬æ¶ˆæ¯ | âœ… å·²å®Œæˆ |
| F-013 | æ¥æ”¶å®æ—¶æ¶ˆæ¯ | âœ… å·²å®Œæˆ |
| F-014 | å†å²æ¶ˆæ¯æŸ¥è¯¢ | âœ… å·²å®Œæˆ |
| F-015 | åœ¨çº¿çŠ¶æ€æ˜¾ç¤º | âœ… å·²å®Œæˆ |
| F-016 | è¾“å…¥çŠ¶æ€æŒ‡ç¤º | âœ… å·²å®Œæˆ |
| F-017 | æ¶ˆæ¯é€šçŸ¥ | âœ… å·²å®Œæˆ |
| F-018 | æ–‡ä»¶åˆ†äº« | ğŸš§ å¼€å‘ä¸­ |
| F-019 | æ¶ˆæ¯æœç´¢ | âŒ æœªå¼€å§‹ |
| F-020 | æ¶ˆæ¯å·²è¯»çŠ¶æ€ | âŒ æœªå¼€å§‹ |

> è¯¦ç»†ä¿¡æ¯è§ [åŠŸèƒ½æ¸…å•](./åŠŸèƒ½æ¸…å•.md) å¯¹åº”æ¡ç›®

---

## 5. æ¨¡å—åŠŸèƒ½æ€»è§ˆ

| æ¨¡å— | åŠŸèƒ½æ€»æ•° | å·²å®Œæˆ | å¼€å‘ä¸­ | æœªå¼€å§‹ | å®Œæˆç‡ |
|------|---------|--------|--------|--------|--------|
| AuthModule | 5 | 5 | 0 | 0 | 100% |
| UserModule | 5 | 5 | 0 | 0 | 100% |
| ChatModule | 10 | 7 | 1 | 2 | 70% |
| **æ€»è®¡** | **20** | **17** | **1** | **2** | **85%** |

**çŠ¶æ€å›¾ä¾‹**:
- âœ… å·²å®Œæˆ: åŠŸèƒ½å¼€å‘å®Œæˆã€æµ‹è¯•é€šè¿‡ã€å·²åˆå¹¶
- ğŸš§ å¼€å‘ä¸­: æ­£åœ¨å¼€å‘ä¸­
- âŒ æœªå¼€å§‹: å·²è§„åˆ’ä½†æœªå¼€å§‹

---

## 6. æ•°æ®åº“è¡¨æ€»è§ˆ

| è¡¨å | æ‰€å±æ¨¡å— | ä¸»è¦å­—æ®µ | å…³é”®ç´¢å¼• |
|------|---------|---------|---------|
| users | AuthModule | id, email, password_hash | email (UNIQUE) |
| auth_tokens | AuthModule | id, user_id, token, expires_at | user_id, token |
| user_profiles | UserModule | id, user_id, display_name, avatar_url | user_id (FK) |
| chat_rooms | ChatModule | id, name, type, created_at | name |
| messages | ChatModule | id, room_id, sender_id, content, sent_at | room_id, sender_id, sent_at |
| room_members | ChatModule | id, room_id, user_id, joined_at | room_id, user_id |

---

## ğŸ“‹ é™„å½•

### ç›¸å…³æ–‡æ¡£
- [åŠŸèƒ½æ¸…å•](./åŠŸèƒ½æ¸…å•.md) - æ¯ä¸ªåŠŸèƒ½çš„è¯¦ç»†æè¿°å’ŒTODO
- [éœ€æ±‚è¯„å®¡å†³ç­–æ ‘](./01-éœ€æ±‚è¯„å®¡å†³ç­–æ ‘.md)
- [æ ¸å¿ƒå¼€å‘æµç¨‹](./02-æ ¸å¿ƒå¼€å‘æµç¨‹.md)
- [é™„åŠ ææ–™](./é™„åŠ ææ–™/) - ç¼–ç è§„èŒƒã€æŠ€æœ¯æ ‡å‡†

### æ–‡æ¡£ç»´æŠ¤è§„åˆ™
1. æ–°å¢æ¨¡å—æ—¶ï¼Œå¿…é¡»åœ¨æœ¬æ–‡æ¡£ä¸­æ·»åŠ å¯¹åº”ç« èŠ‚
2. åŠŸèƒ½çŠ¶æ€ä¸åŠŸèƒ½æ¸…å•æ–‡æ¡£ä¿æŒåŒæ­¥
3. æŠ€æœ¯æ ˆç‰ˆæœ¬å˜æ›´æ—¶åŠæ—¶æ›´æ–°
4. æ¯æ¬¡æ¶æ„è°ƒæ•´éœ€æ›´æ–°æ¶æ„å›¾å’Œäº¤äº’å›¾

---

**æœ€åæ›´æ–°**: YYYY-MM-DD
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
