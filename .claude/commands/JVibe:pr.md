---
name: JVibe:pr
description: 生成标准化的 Pull Request 描述
---

# /JVibe:pr - 生成 Pull Request 描述

你需要生成符合 VibeDoc 规范的 PR 描述，包含变更总结、关联功能、命中规范清单和测试计划。

## 任务

调用 **reviewer Sub-Agent** 完成以下工作：

1. **分析代码变更**
   - 执行 `git diff` 获取变更内容
   - 识别变更的文件和模块
   - 分析变更类型（新功能/Bug修复/重构/文档等）

2. **关联功能**
   - 从功能清单中找到本次 PR 关联的功能编号（F-XXX）
   - 列出相关的 TODO 项

3. **规范检查**
   - 读取附加材料中的规范条目
   - 匹配本次变更命中的规范（CS-/API-/DB-/SEC-/TEST-等）
   - 说明如何满足这些规范

4. **生成 PR 描述**

## PR 描述格式

```markdown
## Summary
- [变更点1：简要描述]
- [变更点2：简要描述]
- [变更点3：简要描述]

## Related Features
- F-XXX: [功能名称]
  - [相关 TODO 1]
  - [相关 TODO 2]

## Hit Specs
本次变更涉及以下规范，已确认满足：

- [ ] **CS-001**: SOLID原则检查
  - ✅ 每个类遵循单一职责原则
  - ✅ 新增模块符合开闭原则

- [ ] **SEC-001**: SQL注入防范
  - ✅ 使用参数化查询
  - ✅ ORM 方式操作数据库

- [ ] **API-002**: 统一响应格式
  - ✅ 所有 API 返回包含 code/message/data 字段

- [ ] **TEST-001**: 测试覆盖率要求
  - ✅ 单元测试覆盖率 85%
  - ✅ 核心模块测试覆盖率 92%

## Test Plan
- [ ] 单元测试通过 (`npm test`)
- [ ] 集成测试通过
- [ ] 手动测试验证
  - [ ] [测试场景1]
  - [ ] [测试场景2]
- [ ] 代码审查通过

## Breaking Changes
[如有破坏性变更，详细说明；否则写 "None"]

## Screenshots (if applicable)
[如涉及 UI 变更，添加截图或 GIF]

## Additional Notes
[其他需要说明的内容]
```

## 调用方式

```yaml
# 主 Agent 调用 reviewer Sub-Agent
task: 生成 PR 描述
agent: reviewer
input:
  - git diff 输出
  - 功能清单
  - 附加材料
output:
  - 标准化的 PR 描述（Markdown 格式）
```

## 输出格式

生成的 PR 描述应该可以**直接复制粘贴到 GitHub/GitLab**，无需手动修改。

输出示例：

```
✅ PR 描述已生成！

---
[以下内容可直接复制到 PR 描述框]

## Summary
- 实现文件上传功能，支持图片和文档
- 添加图片缩略图自动生成
- 集成 S3 云存储

## Related Features
- F-018: 文件上传
  - ✅ 实现 POST /api/files 端点
  - ✅ 文件类型和大小验证
  - ✅ 图片缩略图生成
  - ✅ S3 云存储集成
  - ✅ 单元测试和集成测试

## Hit Specs
本次变更涉及以下规范，已确认满足：

- [ ] **CS-003**: 函数复杂度限制
  - ✅ 所有函数圈复杂度 ≤ 8

- [ ] **SEC-001**: SQL注入防范
  - ✅ 使用 Prisma ORM 参数化查询

- [ ] **SEC-003**: 敏感信息保护
  - ✅ S3 密钥使用环境变量

- [ ] **TEST-001**: 测试覆盖率要求
  - ✅ 单元测试覆盖率 88%

## Test Plan
- [x] 单元测试通过
- [x] 集成测试通过
- [ ] 手动测试验证
  - [ ] 上传图片文件（JPG, PNG）
  - [ ] 上传文档文件（PDF, DOCX）
  - [ ] 验证文件大小限制（50 MB）
  - [ ] 验证缩略图生成
  - [ ] 验证 S3 存储
- [ ] 代码审查通过

## Breaking Changes
None

## Screenshots
[待添加上传界面截图]

---
```

## 注意事项

1. **自动识别功能**：从 commit 信息和文件变更中识别关联的 F-XXX
2. **规范匹配准确**：只列出真正命中的规范，不要无关的
3. **测试计划具体**：测试项应该具体可执行，不是泛泛而谈
4. **格式标准化**：严格遵循格式，便于团队统一
5. **一键复制**：输出的内容应该可以直接使用，不需要手动调整
