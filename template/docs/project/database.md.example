# æ•°æ®åº“ Schema æ–‡æ¡£

> **æ–‡æ¡£ID**: P-002
> **ç»´æŠ¤è€…**: åç«¯å›¢é˜Ÿ
> **æœ€åæ›´æ–°**: YYYY-MM-DD

---

## ğŸ“Œ æ–‡æ¡£è¯´æ˜

**æ˜¯ä»€ä¹ˆ**ï¼šè®°å½•é¡¹ç›®æ•°æ®åº“è¡¨ç»“æ„ã€ç´¢å¼•ç­–ç•¥å’Œ ER å›¾ã€‚

**æ€ä¹ˆç”¨**ï¼š
- ç¼–å†™æŸ¥è¯¢æ—¶ï¼šäº†è§£è¡¨ç»“æ„å’Œå…³è”å…³ç³»
- è®¾è®¡æ–°åŠŸèƒ½æ—¶ï¼šè¯„ä¼°æ•°æ®æ¨¡å‹å½±å“
- æ€§èƒ½ä¼˜åŒ–æ—¶ï¼šæŸ¥çœ‹ç´¢å¼•è®¾è®¡

**æ›´æ–°æ—¶æœº**ï¼š
- æ–°å¢æ•°æ®è¡¨æ—¶
- ä¿®æ”¹è¡¨ç»“æ„æ—¶
- æ·»åŠ /ä¿®æ”¹ç´¢å¼•æ—¶

---

## 1. æ¦‚è¿°

### 1.1 æ•°æ®åº“ä¿¡æ¯

| é¡¹ç›® | å€¼ |
|------|-----|
| æ•°æ®åº“ç±»å‹ | PostgreSQL |
| ç‰ˆæœ¬ | 15.5 |
| ORM | Prisma |
| å­—ç¬¦é›† | UTF-8 |

### 1.2 ER å›¾

```mermaid
erDiagram
    users ||--o{ auth_tokens : has
    users ||--|| user_profiles : has
    users ||--o{ room_members : joins
    chat_rooms ||--o{ room_members : contains
    chat_rooms ||--o{ messages : contains
    users ||--o{ messages : sends

    users {
        uuid id PK
        string email UK
        string password_hash
        timestamp created_at
    }

    user_profiles {
        uuid id PK
        uuid user_id FK
        string display_name
        string avatar_url
    }

    chat_rooms {
        uuid id PK
        string name
        string type
        timestamp created_at
    }

    messages {
        uuid id PK
        uuid room_id FK
        uuid sender_id FK
        text content
        timestamp sent_at
    }
```

---

## 2. è¡¨ç»“æ„è¯¦æƒ…

### 2.1 usersï¼ˆç”¨æˆ·è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| id | UUID | PK | ä¸»é”® |
| email | VARCHAR(255) | UNIQUE, NOT NULL | é‚®ç®± |
| password_hash | VARCHAR(255) | NOT NULL | å¯†ç å“ˆå¸Œ |
| created_at | TIMESTAMP | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | DEFAULT NOW() | æ›´æ–°æ—¶é—´ |

**ç´¢å¼•**ï¼š
- `users_email_idx` (email) - å”¯ä¸€ç´¢å¼•

### 2.2 user_profilesï¼ˆç”¨æˆ·èµ„æ–™è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| id | UUID | PK | ä¸»é”® |
| user_id | UUID | FK, UNIQUE | å…³è”ç”¨æˆ· |
| display_name | VARCHAR(100) | | æ˜¾ç¤ºåç§° |
| avatar_url | VARCHAR(500) | | å¤´åƒURL |
| bio | TEXT | | ä¸ªäººç®€ä»‹ |

**ç´¢å¼•**ï¼š
- `user_profiles_user_id_idx` (user_id) - å”¯ä¸€ç´¢å¼•

### 2.3 chat_roomsï¼ˆèŠå¤©å®¤è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| id | UUID | PK | ä¸»é”® |
| name | VARCHAR(100) | NOT NULL | èŠå¤©å®¤åç§° |
| type | VARCHAR(20) | NOT NULL | ç±»å‹ï¼ˆprivate/groupï¼‰ |
| created_at | TIMESTAMP | DEFAULT NOW() | åˆ›å»ºæ—¶é—´ |

**ç´¢å¼•**ï¼š
- `chat_rooms_name_idx` (name)

### 2.4 messagesï¼ˆæ¶ˆæ¯è¡¨ï¼‰

| å­—æ®µ | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|------|------|------|------|
| id | UUID | PK | ä¸»é”® |
| room_id | UUID | FK, NOT NULL | èŠå¤©å®¤ID |
| sender_id | UUID | FK, NOT NULL | å‘é€è€…ID |
| content | TEXT | NOT NULL | æ¶ˆæ¯å†…å®¹ |
| sent_at | TIMESTAMP | DEFAULT NOW() | å‘é€æ—¶é—´ |

**ç´¢å¼•**ï¼š
- `messages_room_id_idx` (room_id)
- `messages_sender_id_idx` (sender_id)
- `messages_sent_at_idx` (sent_at)

---

## 3. ç´¢å¼•ç­–ç•¥

### 3.1 ç´¢å¼•è®¾è®¡åŸåˆ™

å‚è€ƒ [é™„åŠ ææ–™ DB-002](../core/é™„åŠ ææ–™.md)ï¼š
- å¤–é”®å­—æ®µå¿…é¡»å»ºç´¢å¼•
- æŸ¥è¯¢æ¡ä»¶å¸¸ç”¨å­—æ®µå»ºç´¢å¼•
- é¿å…è¿‡åº¦ç´¢å¼•

### 3.2 å½“å‰ç´¢å¼•åˆ—è¡¨

| è¡¨ | ç´¢å¼•å | å­—æ®µ | ç±»å‹ |
|-----|--------|------|------|
| users | users_email_idx | email | UNIQUE |
| user_profiles | user_profiles_user_id_idx | user_id | UNIQUE |
| chat_rooms | chat_rooms_name_idx | name | BTREE |
| messages | messages_room_id_idx | room_id | BTREE |
| messages | messages_sender_id_idx | sender_id | BTREE |
| messages | messages_sent_at_idx | sent_at | BTREE |

---

## 4. è¿ç§»å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|------|------|------|
| 001 | YYYY-MM-DD | åˆå§‹åŒ–æ•°æ®åº“ç»“æ„ |
| 002 | YYYY-MM-DD | æ·»åŠ  messages è¡¨ |

---

## ğŸ“‹ é™„å½•

### ç›¸å…³æ–‡æ¡£

- [è§„èŒƒæ–‡æ¡£](../core/è§„èŒƒæ–‡æ¡£.md) - æ–‡æ¡£ä½“ç³»å…¥å£
- [é™„åŠ ææ–™](../core/é™„åŠ ææ–™.md) - æ•°æ®åº“è®¾è®¡è§„èŒƒï¼ˆDB-001~003ï¼‰
